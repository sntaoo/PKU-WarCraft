# 思路梳理

## 思路梳理和代码只是辅助，请独立完成作业噢

- 和魔兽三的不同之处
  - 战斗方式
    - 由循环攻击直到得到战斗结果，变为仅一方主动攻击一次和存活反击
    - 战斗胜利后出现奖励机制，必要条件是敌人被杀死而不是存活，也即是一方存活，一方死亡
    - 敌人提前被弓箭射死，视为战斗胜利，会触发战斗胜利的事件
    - 战斗结束如果有战士死亡，那么存活的战士取得城市生命元
    - 狼战斗结束还会抢夺武器，但不会抢夺重复的武器
    - 战斗定义为40分发生的事件，其余的武士死亡不是战斗，自然不会触发战斗后才会发生的事件，如拿走生命元、奖励，生命元转移等
  - 武器的持有方式
    - 宝剑不再是持久的，而有初始攻击力，还会变钝
    - 武器是定量的，且不会拥有重复武器
  - 武器的攻击方式
    - 弓箭射的是下一个城市的敌人，但不会射司令部的敌人
    - 炸弹使用后双方一定都会死掉，战斗结束双方都不能拿走生命元
    - 如果一个城市的两个武士都被射死，相当于本城市没有发生战斗
  - 战士
    - 龙重新拥有士气属性，士气决定龙是否欢呼。龙的士气回随着战斗进行而改变（而不再是行进中改变）
    - ninja有两件武器，ninja不会反击（所以如果后手是ninja。则先手不会被反击致死，必然不会使用炸弹）
    - lion的忠诚度的降低方式不是因为行进而是因为战斗结果。lion的生命值会在战死后转移到对方身上。
      - 如果lion提前被弓箭杀死，不会触发生命值转移
    - 雪人的生命值再前进时的减少，同时攻击力增加
      - 如果生命值不够减了，生命值变为1，但是攻击力还会加
  - 武士的生产方式
    - 从不够之后就再也补生产武士，变成等待生命元足够再生产下一个武士（可复用三）
  - 城市的组织方式
    - 城市多了一面旗帜
  - 交代武器情况的顺序和形式变了
  - 司令部是否被占领的判断改变了

- 战斗函数
  - 先全线战斗，根据战斗结果插旗帜，清理战场，狼缴获武器，胜利后立即受到司令部奖励，再依次回收城市的生命元
  - 战斗时只会使用宝剑进行进攻，如果没有宝剑，视宝剑攻击力为0，lion一直没有武器
  - 战斗中只会使用宝剑，宝剑攻击力为0 <==> 没有宝剑

- 定义旗帜状态enum
  - NONE_FLAG,BLUE_FLAG,RED_FLAG

- 城市类添加成员变量和函数
  - 旗帜变量、生命元变量、上一场战斗的结果
  - 产生生命元的函数
  - 根据本次战斗结果和上次战斗结果升降旗帜
    - 旗帜的更换动作仅由战斗函数触发

- 重写武器类
  - 宝剑添加攻击力成员变量
  - 弓箭可使用次数变为3
  - 更改炸弹为必杀

- 重写战士类
  - 重写战士的march函数
    - 雪人的血量和攻击力属性需要变化
      - 生命值小于9，生命值不会减少，攻击力会增加
    - 龙的士气和狮子的忠诚度不会因为行进而改变

  - 重写战士的武器形式
    - 三个指针，分别指向某武器
    - 获取宝剑的攻击力的函数

  - 编写战士的析构函数，free掉武器指针

  - 添加是否使用炸弹的函数

  - 拿走生命元的函数

  - 只有狼在战斗结束之后抢夺武器 
 
- 重载operator<<输出战士、武器

- 重写战士的战斗结果后果
  - 定义基类虚函数接口
  - 龙主动进攻且没有战死，就会欢呼（反击打死敌人不会欢呼，主动进攻且存活会欢呼，即使没有获得战斗胜利）
  - 龙的敌人被杀死，他的士气增加（龙方win）
  - 狮子敌人未被杀死，忠诚度降低（存活平局）
  - 狼赢了会抢夺武器


- 一些可能的bug
  - 检查输出顺序
  - 后手方为ninja，不会使用炸弹
  - 战斗结束要设置上一局战斗的状态
    - 如果两者被炸弹炸死，或者都被弓箭射死，则不算战斗
  - 拼写错误
  - 指针赋值转移后一定要把老指针置空，否则可能会被析构函数析构掉（如果你写了析构函数的话）
  - delete指针后一定要置空
  - 构造函数的初始化写对了吗？比如name(name_)写成了name(name),导致用随机值初始化了name

- 高效debug方法：
  - 段错误有时很难通过printf大法找到，比如我今天遇到的一个bug, 攻击的时候寻找weapons["sword"]的武器指针出来攻击，但是因为笔误写成weapons["seord"]导致hash_map返回空指针造成非法引用，而且并没有当下立刻地停止运行代码（我还没搞清楚为什么），靠肉眼和printf是很难找到的，但是gdb一分钟就定位到了。
  - 段错误（rte）的处理办法
     1. 找一台ubuntu虚拟机，把代码转移过去
     2. terminal 中使用g++ -o xxx yyy.cpp 进行编译
        1. 如果代码有问题导致段错误，比如期待返回指针但是没有返回等，会在这里报错，修改之
     3. gdb xxx
        1. run < in.txt > out.txt
  会定位到导致段错误的语句，再进行修改
  
